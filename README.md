# Task Management Backend

NestJS + TypeORM implementation of the Viamagus assignment. It exposes secure APIs to manage teams, team members, and tasks while persisting data in MongoDB.

## Features

- JWT-based authentication with configurable demo credentials stored in `.env`
- Team management (create teams, list teams, add members later)
- Task management (create, update, assign, list with assignee + team context)
- TypeORM models for `Team`, `TeamMember`, and `Task` with relational integrity
- Request validation via `class-validator`/`class-transformer`
- Ready-to-import Postman collection for quick testing

## Tech Stack

- **Runtime**: Node.js 22+, NestJS 11
- **Persistence**: TypeORM with MongoDB (uses the official `mongodb` driver)
- **Auth**: `@nestjs/jwt`, `passport-jwt`
- **Tooling**: ESLint + Prettier, Jest (default Nest setup)

## Getting Started

1. **Install dependencies**
   ```bash
   npm install
   ```
2. **Copy the environment template and adjust values**
   ```bash
   cp .env.example .env
   ```
   Required variables:
   - `DATABASE_URL`: Mongo connection string (e.g. `mongodb://localhost:27017/task_tracker`).
   - `DATABASE_NAME`: Database to use (if omitted, the one in the URL is used).
   - `AUTH_USERNAME` / `AUTH_PASSWORD`: hardcoded credentials accepted by the `/auth/login` endpoint.
   - `JWT_SECRET`: signing key used for JWTs (tokens issued by default never expire).
3. **Run the application**
   ```bash
   npm run start:dev
   ```
   The API listens on `http://localhost:${PORT}` (`3000` by default). TypeORM runs with `synchronize: true` for rapid iteration; switch to migrations in production.

## Authentication Flow

Every endpoint except `POST /auth/login` is protected by the JWT guard.

```http
POST /auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "pass123"
}
```
Response:
```json
{
  "accessToken": "<JWT>",
  "tokenType": "Bearer",
  "expiresIn": "3600s"
}
```
Use the returned token in the `Authorization: Bearer <token>` header for subsequent calls.

## API Surface

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/auth/login` | Exchange hardcoded credentials for a JWT |
| POST | `/teams` | Create a team (optionally seed members) |
| GET | `/teams` | List all teams with their members |
| GET | `/teams/:id` | Fetch a single team with members |
| POST | `/teams/:id/members` | Add another member to an existing team |
| POST | `/tasks` | Create a task; accepts optional `assigneeId`, `teamId`, `dueDate`, `status` |
| GET | `/tasks` | List every task including its assignee + team |
| GET | `/tasks/:id` | Fetch a single task with relations |
| PATCH | `/tasks/:id` | Update task properties such as status, due date, or reassignment |
| PATCH | `/tasks/:id/assign` | Assign/reassign a task to a team member |

### Task Payload Notes

- `status` enum: `PENDING`, `IN_PROGRESS`, `COMPLETED`, `BLOCKED`.
- `dueDate` should be an ISO-8601 string (`2025-01-30T12:00:00Z`).
- When `assigneeId` is provided, the task automatically inherits the member's team. Passing both `teamId` and `assigneeId` enforces that the member belongs to that team.

## Postman Collection

The workspace includes `postman/task-manager.postman_collection.json` with ready-made requests covering the login, team, and task flows. Import it into Postman, edit the `{{host}}` variable if needed, and supply the JWT via the `token` collection variable (generated by the login request script).

## Testing & Linting

- Run type-checks/tests: `npm run test`
- Lint & format: `npm run lint` and `npm run format`

## Notes

- The service runs with full type checking and DTO validation enabled (via Nest's global `ValidationPipe`).
- Because TypeORM synchronization is enabled for convenience, avoid pointing the app at a production database without disabling `synchronize` and introducing migrations.
